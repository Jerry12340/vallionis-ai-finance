{% extends "base.html" %}

{% block title %}AI Stock Recommendations - Vallionis AI Finance{% endblock %}

{% block meta_description %}Get personalized AI-powered stock recommendations based on your risk tolerance and investment goals. Professional portfolio analysis and investment advice.{% endblock %}

{% block meta_keywords %}AI stock recommendations, investment advice, portfolio analysis, stock market, financial planning, investment strategy, risk management, stock picks{% endblock %}

{% block og_title %}AI Stock Recommendations - Vallionis AI Finance{% endblock %}

{% block og_description %}Get personalized AI-powered stock recommendations tailored to your investment style and risk tolerance. Professional portfolio analysis and investment advice.{% endblock %}

{% block twitter_title %}AI Stock Recommendations - Vallionis AI Finance{% endblock %}

{% block twitter_description %}Get personalized AI-powered stock recommendations tailored to your investment style and risk tolerance.{% endblock %}

{% block content %}
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-content">
        <div class="spinner"></div>
        <h3>Analyzing Market Data</h3>
        <p>Our AI is processing thousands of data points to find the best stocks for you...</p>
        <p>This generally takes 3-5 minutes</p>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
    </div>
</div>

<!-- Hero Section -->
<div class="hero-section fade-in-up">
    <div class="hero-content">
        <h1>AI-Powered Stock Recommendations</h1>
        <p class="hero-subtitle">Get personalized investment advice based on your risk tolerance, time horizon, and investment goals.</p>
        
        {% if current_user.is_authenticated %}
            <div class="user-welcome">
                <i class="fas fa-user-circle"></i>
                <span>Welcome back, {{ current_user.email.split('@')[0] }}!</span>
                {% if current_user.get_subscription_status() %}
                    <span class="premium-badge">
                        <i class="fas fa-crown"></i>
                        Premium Member
                    </span>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<!-- Main Form Section -->
<div class="main-content fade-in-up">
    <div class="form-container">
        <div class="form-header">
            <h2>Get Your Personalized Recommendations</h2>
            <p>Fill out the form below to receive AI-generated stock recommendations tailored to your investment profile.</p>
        </div>

        <form method="POST" id="recommendationForm" class="recommendation-form">
            {{ form.hidden_tag() }}

            <!-- Error Display -->
            {% if form.errors %}
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Please correct the following errors:</strong>
                <ul>
                    {% for field, errors in form.errors.items() %}
                        {% for error in errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Basic Investment Preferences -->
            <div class="form-section">
                <h3><i class="fas fa-chart-line"></i> Investment Preferences</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        {{ form.investing_style.label(class="form-label") }}
                        {{ form.investing_style(class="form-control form-control-lg") }}
                        {% for error in form.investing_style.errors %}
                            <small class="text-danger">{{ error }}</small>
                        {% endfor %}
                        <small class="form-help">
                            <i class="fas fa-info-circle"></i>
                            Conservative: Lower risk, stable returns | Moderate: Balanced approach | Aggressive: Higher risk, higher potential returns
                        </small>
                    </div>

                    <div class="form-group">
                        {{ form.time_horizon.label(class="form-label") }}
                        {{ form.time_horizon(class="form-control form-control-lg") }}
                        {% for error in form.time_horizon.errors %}
                            <small class="text-danger">{{ error }}</small>
                        {% endfor %}
                        <small class="form-help">
                            <i class="fas fa-calendar"></i>
                            How long you plan to hold these investments
                        </small>
                    </div>
                </div>

                <div class="form-group">
                    {{ form.stocks_amount.label(class="form-label") }}
                    {{ form.stocks_amount(class="form-control form-control-lg") }}
                    {% for error in form.stocks_amount.errors %}
                        <small class="text-danger">{{ error }}</small>
                    {% endfor %}
                    <small class="form-help">
                        <i class="fas fa-list"></i>
                        Number of stocks to include in your portfolio (5-20 recommended)
                    </small>
                </div>
            </div>

            <!-- Premium Features Section -->
            <div class="form-section premium-section">
                <div class="premium-header">
                    <h3><i class="fas fa-crown"></i> Premium Features</h3>
                    <span class="premium-badge">PREMIUM</span>
                </div>
                
                <div class="premium-toggle">
                    <div class="form-check form-switch">
                        {{ form.premium(class="form-check-input", id="premiumToggle", disabled=not is_premium_user) }}
                        {{ form.premium.label(class="form-check-label") }}
                    </div>
                    {% if not is_premium_user %}
                        <small class="premium-note">
                            <i class="fas fa-lock"></i>
                            <a href="{{ url_for('subscription') }}">Upgrade to Premium</a> to unlock advanced features
                        </small>
                    {% endif %}
                </div>

                <div id="premiumFields" class="premium-fields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.sector_focus.label(class="form-label") }}
                            {{ form.sector_focus(class="form-control form-control-lg", disabled=not is_premium_user) }}
                            <small class="form-help">
                                <i class="fas fa-industry"></i>
                                Focus on specific sectors or diversify across all
                            </small>
                        </div>

                        <div class="form-group">
                            {{ form.risk_tolerance.label(class="form-label") }}
                            {{ form.risk_tolerance(class="form-control form-control-lg", disabled=not is_premium_user) }}
                            <small class="form-help">
                                <i class="fas fa-shield-alt"></i>
                                Fine-tune your risk tolerance level
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-check form-switch">
                            {{ form.dividend_preference(class="form-check-input", id="dividendPreference", disabled=not is_premium_user) }}
                            {{ form.dividend_preference.label(class="form-check-label") }}
                        </div>
                        <small class="form-help">
                            <i class="fas fa-coins"></i>
                            Prioritize stocks that pay regular dividends
                        </small>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                    <i class="fas fa-magic"></i>
                    Generate Recommendations
                </button>
                
                <div class="form-note">
                    <i class="fas fa-clock"></i>
                    Analysis typically takes 3-5 minutes
                </div>
            </div>
        </form>
    </div>

    <!-- Subscription CTA for Non-Premium Users -->
    {% if not is_premium_user %}
    <div class="upgrade-cta fade-in-up">
        <div class="cta-card" style="padding: 2.5rem;">
            <div class="cta-header" style="padding-bottom: 1.75rem;">
                <i class="fas fa-rocket" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                <h3 style="margin-top: 0.75rem; margin-bottom: 0.5rem;">Unlock Premium Features</h3>
                <p style="margin-bottom: 0; font-size: 1.1rem;">Get more personalized recommendations with advanced filtering options</p>
            </div>

            <div class="premium-features" style="padding: 1.75rem 0;">
                <h4 style="margin-top: 0; margin-bottom: 1.25rem;">Premium Features</h4>
                <ul style="margin-bottom: 2rem; padding-left: 1.5rem; list-style-type: none;">
                    <li style="padding: 0.5rem 0; font-size: 1.05rem;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 0.75rem;"></i> Sector-specific recommendations</li>
                    <li style="padding: 0.5rem 0; font-size: 1.05rem;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 0.75rem;"></i> Custom risk tolerance settings</li>
                    <li style="padding: 0.5rem 0; font-size: 1.05rem;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 0.75rem;"></i> Dividend-focused portfolios</li>
                    <li style="padding: 0.5rem 0; font-size: 1.05rem;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 0.75rem;"></i> CSV export functionality</li>
                    <li style="padding: 0.5rem 0; font-size: 1.05rem;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 0.75rem;"></i> 3x faster processing</li>
                </ul>
                <div class="pricing-info" style="padding-top: 1.5rem; border-top: 1px solid #eee;">
                    <p style="margin-bottom: 1.5rem; font-size: 1.15rem;">
                        <strong style="font-size: 1.25rem;">{{ currency_config.symbol if currency_config else '£' }}{{ currency_config.monthly_price if currency_config else '4.99' }}/month</strong>
                        <span style="margin: 0 0.5rem;">or</span>
                        <strong style="font-size: 1.25rem;">{{ currency_config.symbol if currency_config else '£' }}{{ currency_config.lifetime_price if currency_config else '99.99' }} lifetime</strong>
                    </p>
                    <a href="{{ url_for('subscription') }}" class="btn btn-primary" style="padding: 0.85rem 2rem; font-size: 1.1rem; border-radius: 6px;">Upgrade to Premium</a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Features Section -->
<div class="features-section fade-in-up">
    <h2>Why Choose Vallionis AI Finance?</h2>
    <div class="features-grid">
        <div class="feature-card">
            <i class="fas fa-brain"></i>
            <h3>AI-Powered Analysis</h3>
            <p>Our advanced algorithms analyze thousands of data points to identify the best investment opportunities.</p>
        </div>
        <div class="feature-card">
            <i class="fas fa-user-cog"></i>
            <h3>Personalized Recommendations</h3>
            <p>Get recommendations tailored to your specific risk tolerance, time horizon, and investment goals.</p>
        </div>
        <div class="feature-card">
            <i class="fas fa-chart-bar"></i>
            <h3>Comprehensive Data</h3>
            <p>Access real-time market data, financial ratios, and growth projections for informed decisions.</p>
        </div>
        <div class="feature-card">
            <i class="fas fa-shield-alt"></i>
            <h3>Risk Management</h3>
            <p>Our recommendations include risk assessment and portfolio diversification strategies.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const premiumToggle = document.getElementById('premiumToggle');
    const premiumFields = document.getElementById('premiumFields');
    const form = document.getElementById('recommendationForm');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Premium toggle functionality
    if (premiumToggle) {
        premiumToggle.addEventListener('change', function() {
            if (this.checked) {
                premiumFields.style.display = 'block';
                premiumFields.classList.add('fade-in-up');
            } else {
                premiumFields.style.display = 'none';
            }
        });
    }

    // Form submission with loading animation
    form.addEventListener('submit', function(e) {
        loadingOverlay.style.display = 'flex';

        // Simulate progress bar
        const progressFill = document.querySelector('.progress-fill');
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 90) progress = 90;
            progressFill.style.width = progress + '%';
        }, 500);

        // Store interval to clear later
        window.progressInterval = interval;
    });

    // Add smooth animations to elements
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-up');
            }
        });
    }, observerOptions);

    // Observe all feature cards and sections
    document.querySelectorAll('.feature-card, .form-section, .upgrade-cta').forEach(el => {
        observer.observe(el);
    });
});
</script>
{% endblock %}
